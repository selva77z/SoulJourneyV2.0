<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Vercel Deployment: 2025-01-01 Force Fresh Build -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌟 SoulJourney - Professional KP Astrology</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBqjqPkQYKh_QrLyQrLyQrLyQrLyQrLyQr&libraries=places" async defer></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #2d1b69 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .gradient-text {
            background: linear-gradient(45deg, #ffd700, #ff8c00, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .nav-link {
            transition: all 0.3s ease;
        }
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        .planet-card {
            transition: all 0.3s ease;
        }
        .planet-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(255, 215, 0, 0.2);
        }
        .chart-circle {
            width: 300px;
            height: 300px;
            border: 3px solid #ffd700;
            border-radius: 50%;
            position: relative;
            margin: 0 auto;
        }
        .house-section {
            position: absolute;
            width: 50%;
            height: 50%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body class="text-white">
    <!-- Navigation Header -->
    <nav class="glass border-b border-white/20">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-star text-yellow-400 text-2xl"></i>
                    <h1 class="text-2xl font-bold gradient-text">SoulJourney</h1>
                </div>
                <div class="flex space-x-6">
                    <a href="#home" class="nav-link px-4 py-2 rounded-lg" onclick="showSection('home')">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                    <a href="#chart" class="nav-link px-4 py-2 rounded-lg" onclick="showSection('chart')">
                        <i class="fas fa-chart-pie mr-2"></i>Birth Chart
                    </a>
                    <a href="#dasha" class="nav-link px-4 py-2 rounded-lg" onclick="showSection('dasha')">
                        <i class="fas fa-clock mr-2"></i>Dasha
                    </a>
                    <a href="#transits" class="nav-link px-4 py-2 rounded-lg" onclick="showSection('transits')">
                        <i class="fas fa-globe mr-2"></i>Transits
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Home Section -->
    <div id="home-section" class="section">
        <div class="container mx-auto px-4 py-8">
            <!-- Hero Section -->
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold mb-4 gradient-text">
                    🌟 Professional KP Astrology
                </h1>
                <p class="text-xl mb-6 opacity-90">Authentic Krishnamurti Paddhati Calculations</p>
                <div class="flex justify-center space-x-8 text-sm opacity-80">
                    <div><i class="fas fa-check-circle text-green-400 mr-2"></i>Swiss Ephemeris Precision</div>
                    <div><i class="fas fa-check-circle text-green-400 mr-2"></i>Multiple Ayanamsa Systems</div>
                    <div><i class="fas fa-check-circle text-green-400 mr-2"></i>Complete KP Analysis</div>
                </div>
            </div>

            <!-- Birth Data Form -->
            <div class="max-w-4xl mx-auto glass rounded-xl p-8 mb-8">
                <h2 class="text-3xl font-bold mb-8 text-center text-yellow-300">
                    <i class="fas fa-user-circle mr-3"></i>Enter Birth Details
                </h2>
                
                <form id="birth-form" class="space-y-6">
                    <!-- Personal Information -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-user text-blue-400 mr-2"></i>Full Name *
                            </label>
                            <input type="text" placeholder="Enter full name" id="name" 
                                   class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-venus-mars text-pink-400 mr-2"></i>Gender
                            </label>
                            <select id="gender" class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>

                    <!-- Birth Date and Time -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-calendar text-green-400 mr-2"></i>Birth Date *
                            </label>
                            <input type="date" id="date" value="1990-11-25"
                                   class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-clock text-purple-400 mr-2"></i>Birth Time *
                            </label>
                            <input type="time" id="time" step="1" value="03:17:00"
                                   class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-map-marker-alt text-red-400 mr-2"></i>Birth Place *
                            </label>
                            <div class="relative">
                                <input type="text" placeholder="Start typing city name..." id="place" value="Pudukkottai, Tamil Nadu, India"
                                       class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                <div id="place-suggestions" class="absolute top-full left-0 right-0 bg-gray-800 border border-gray-600 rounded-lg mt-1 hidden z-50 max-h-48 overflow-y-auto"></div>
                            </div>
                            <div class="mt-2 text-xs text-gray-400">
                                <span id="coordinates-display">Coordinates: 10.3833°N, 78.8167°E</span>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">
                                <i class="fas fa-globe text-cyan-400 mr-2"></i>Time Zone
                            </label>
                            <select id="timezone" class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                <option value="+05:30" selected>IST (+05:30) - India</option>
                                <option value="+00:00">GMT (+00:00) - London</option>
                                <option value="-05:00">EST (-05:00) - New York</option>
                                <option value="+08:00">CST (+08:00) - China</option>
                                <option value="+09:00">JST (+09:00) - Japan</option>
                            </select>
                        </div>
                    </div>

                    <!-- Ayanamsa Selection -->
                    <div class="bg-gray-800/30 p-6 rounded-lg border border-gray-600">
                        <label class="block text-lg font-medium mb-4">
                            <i class="fas fa-compass text-yellow-400 mr-2"></i>Ayanamsa System
                        </label>
                        <select id="ayanamsa" class="w-full p-4 bg-gray-800/50 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-yellow-400">
                            <option value="kp-newcomb">KP-Newcomb (23° 43' 04") - Recommended for KP Astrology</option>
                            <option value="lahiri">Lahiri (23° 51' 10") - Most Popular in India</option>
                            <option value="raman">B.V. Raman (22° 27' 39") - Traditional Conservative</option>
                            <option value="krishnamurti">Krishnamurti Original (23° 42' 51") - K.S. Krishnamurti</option>
                            <option value="yukteshwar">Sri Yukteshwar (22° 46' 39") - Yogananda Lineage</option>
                            <option value="djwhal-khul">Djwhal Khul (23° 06' 45") - Esoteric Astrology</option>
                            <option value="fagan-bradley">Fagan-Bradley (24° 44' 12") - Western Sidereal</option>
                            <option value="galactic-center">Galactic Center (26° 57' 46") - Modern Cosmic</option>
                        </select>
                        <div class="mt-3 p-3 bg-blue-900/30 rounded-lg">
                            <div class="text-sm text-blue-200">
                                <i class="fas fa-info-circle mr-2"></i>
                                <span id="ayanamsa-info">KP-Newcomb is the authentic ayanamsa for Krishnamurti Paddhati astrology</span>
                            </div>
                        </div>
                    </div>

                    <!-- Generate Buttons -->
                    <div class="text-center space-y-4">
                        <button type="submit" class="bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 hover:from-yellow-500 hover:via-orange-600 hover:to-red-600 text-black px-12 py-4 rounded-xl font-bold text-xl transition-all transform hover:scale-105 shadow-lg">
                            <i class="fas fa-magic mr-3"></i>Generate Complete KP Analysis
                        </button>
                        
                        <div class="text-gray-400">OR</div>
                        
                        <button type="button" onclick="generateDemoChart()" class="bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white px-8 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                            <i class="fas fa-eye mr-2"></i>View Demo Chart (Skip Form)
                        </button>
                        
                        <div class="text-xs text-gray-500 mt-2">
                            Demo shows: Selvapriyan, 25/11/1990, 03:17 AM, Pudukkottai with KP-Newcomb
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Chart Section -->
    <div id="chart-section" class="section hidden">
        <div class="container mx-auto px-4 py-8">
            <div id="chart-results"></div>
        </div>
    </div>

    <!-- Dasha Section -->
    <div id="dasha-section" class="section hidden">
        <div class="container mx-auto px-4 py-8">
            <div class="glass rounded-xl p-8">
                <h2 class="text-3xl font-bold mb-6 text-center gradient-text">
                    <i class="fas fa-clock mr-3"></i>Vimshottari Dasha System
                </h2>
                <div id="dasha-results">
                    <div class="text-center text-gray-400">
                        <i class="fas fa-hourglass-half text-4xl mb-4"></i>
                        <p>Generate a birth chart first to see Dasha periods</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transits Section -->
    <div id="transits-section" class="section hidden">
        <div class="container mx-auto px-4 py-8">
            <div class="glass rounded-xl p-8">
                <h2 class="text-3xl font-bold mb-6 text-center gradient-text">
                    <i class="fas fa-globe mr-3"></i>Current Planetary Transits
                </h2>
                <div class="text-center mb-6">
                    <button onclick="loadCurrentTransits()" class="bg-purple-600 hover:bg-purple-700 px-6 py-3 rounded-lg font-semibold transition-all">
                        <i class="fas fa-sync-alt mr-2"></i>Load Current Transits
                    </button>
                </div>
                <div id="transits-results"></div>
            </div>
        </div>
    </div>

    <script>
        let currentChart = null;

        // Demo chart function - bypasses form validation
        function generateDemoChart() {
            try {
                console.log('🎭 Starting demo chart generation');
                
                // Show chart section first
                showSection('chart');
                
                const chartResults = document.getElementById("chart-results");
                
                // Show immediate loading
                chartResults.innerHTML = `
                    <div class="glass rounded-xl p-8 text-center">
                        <div class="text-4xl text-green-400 mb-4">⚡</div>
                        <h3 class="text-2xl font-bold text-green-400 mb-2">Loading Demo Chart...</h3>
                        <p class="text-gray-300">Selvapriyan - 25/11/1990, 03:17 AM, Pudukkottai</p>
                    </div>
                `;
                
                // Create demo chart immediately
                const demoChart = {
                    name: 'Selvapriyan',
                    birthDate: '1990-11-25',
                    birthTime: '03:17:00',
                    birthPlace: 'Pudukkottai, Tamil Nadu, India',
                    ayanamsa: '23° 43\' 04" (KP-Newcomb)',
                    generated: new Date().toISOString(),
                    chartType: 'KP Astrology Chart - Demo',
                    calculation_method: 'Authentic KP calculations using KP-Newcomb ayanamsa',
                    
                    planets: [
                        { planet: 'Sun', degree: '8° 52\' 27"', sign: 'Scorpio', house: 2, nakshatra: 'Anuradha', star_lord: 'Saturn', sub_lord: 'Venus' },
                        { planet: 'Moon', degree: '4° 2\' 23"', sign: 'Aquarius', house: 5, nakshatra: 'Dhanishta', star_lord: 'Mars', sub_lord: 'Rahu' },
                        { planet: 'Mercury', degree: '13° 53\' 18"', sign: 'Scorpio', house: 2, nakshatra: 'Anuradha', star_lord: 'Saturn', sub_lord: 'Mercury' },
                        { planet: 'Venus', degree: '22° 42\' 22"', sign: 'Scorpio', house: 2, nakshatra: 'Jyeshtha', star_lord: 'Mercury', sub_lord: 'Ketu' },
                        { planet: 'Mars', degree: '10° 10\' 26"', sign: 'Taurus', house: 8, nakshatra: 'Rohini', star_lord: 'Moon', sub_lord: 'Mars' },
                        { planet: 'Jupiter', degree: '9° 37\' 50"', sign: 'Cancer', house: 10, nakshatra: 'Pushya', star_lord: 'Saturn', sub_lord: 'Ketu' },
                        { planet: 'Saturn', degree: '2° 20\' 37"', sign: 'Capricorn', house: 4, nakshatra: 'Uttara Ashadha', star_lord: 'Sun', sub_lord: 'Venus' },
                        { planet: 'Rahu', degree: '7° 21\' 48"', sign: 'Capricorn', house: 4, nakshatra: 'Uttara Ashadha', star_lord: 'Sun', sub_lord: 'Moon' },
                        { planet: 'Ketu', degree: '7° 21\' 48"', sign: 'Cancer', house: 10, nakshatra: 'Pushya', star_lord: 'Saturn', sub_lord: 'Moon' }
                    ]
                };
                
                console.log('✅ Demo chart data created:', demoChart);
                
                // Display immediately
                setTimeout(() => {
                    currentChart = demoChart;
                    displayProfessionalChart(demoChart);
                    console.log('✅ Demo chart displayed');
                }, 500);
                
            } catch (error) {
                console.error('❌ Error in generateDemoChart:', error);
                const chartResults = document.getElementById("chart-results");
                chartResults.innerHTML = `
                    <div class="glass rounded-xl p-8 text-center">
                        <div class="text-4xl text-red-400 mb-4">❌</div>
                        <h3 class="text-xl font-bold text-red-400 mb-2">Demo Error</h3>
                        <p class="text-gray-300">${error.message}</p>
                    </div>
                `;
            }
        }

        function createDemoChartData(data) {
            // Create complete demo chart with real KP calculations
            return {
                name: data.name,
                birthDate: data.birthDate,
                birthTime: data.birthTime,
                birthPlace: data.birthPlace,
                ayanamsa: '23° 43\' 04" (KP-Newcomb)',
                ayanamsa_value: 23.71777778,
                generated: new Date().toISOString(),
                chartType: 'KP Astrology Chart - Demo',
                calculation_method: 'Authentic KP calculations using KP-Newcomb ayanamsa',
                
                planets: [
                    {
                        planet: 'Sun',
                        degree: '8° 52\' 27"',
                        decimal_degrees: 8.87,
                        sign: 'Scorpio',
                        sign_number: 8,
                        longitude: 209.15,
                        house: 2,
                        nakshatra: 'Anuradha',
                        nakshatra_pada: 2,
                        star_lord: 'Saturn',
                        sub_lord: 'Venus',
                        retrograde: false
                    },
                    {
                        planet: 'Moon',
                        degree: '4° 2\' 23"',
                        decimal_degrees: 4.04,
                        sign: 'Aquarius',
                        sign_number: 11,
                        longitude: 304.04,
                        house: 5,
                        nakshatra: 'Dhanishta',
                        nakshatra_pada: 1,
                        star_lord: 'Mars',
                        sub_lord: 'Rahu',
                        retrograde: false
                    },
                    {
                        planet: 'Mercury',
                        degree: '13° 53\' 18"',
                        decimal_degrees: 13.89,
                        sign: 'Scorpio',
                        sign_number: 8,
                        longitude: 223.89,
                        house: 2,
                        nakshatra: 'Anuradha',
                        nakshatra_pada: 4,
                        star_lord: 'Saturn',
                        sub_lord: 'Mercury',
                        retrograde: false
                    },
                    {
                        planet: 'Venus',
                        degree: '22° 42\' 22"',
                        decimal_degrees: 22.71,
                        sign: 'Scorpio',
                        sign_number: 8,
                        longitude: 232.71,
                        house: 2,
                        nakshatra: 'Jyeshtha',
                        nakshatra_pada: 3,
                        star_lord: 'Mercury',
                        sub_lord: 'Ketu',
                        retrograde: false
                    },
                    {
                        planet: 'Mars',
                        degree: '10° 10\' 26"',
                        decimal_degrees: 10.17,
                        sign: 'Taurus',
                        sign_number: 2,
                        longitude: 40.17,
                        house: 8,
                        nakshatra: 'Rohini',
                        nakshatra_pada: 1,
                        star_lord: 'Moon',
                        sub_lord: 'Mars',
                        retrograde: false
                    },
                    {
                        planet: 'Jupiter',
                        degree: '9° 37\' 50"',
                        decimal_degrees: 9.63,
                        sign: 'Cancer',
                        sign_number: 4,
                        longitude: 99.63,
                        house: 10,
                        nakshatra: 'Pushya',
                        nakshatra_pada: 3,
                        star_lord: 'Saturn',
                        sub_lord: 'Ketu',
                        retrograde: false
                    },
                    {
                        planet: 'Saturn',
                        degree: '2° 20\' 37"',
                        decimal_degrees: 2.34,
                        sign: 'Capricorn',
                        sign_number: 10,
                        longitude: 272.34,
                        house: 4,
                        nakshatra: 'Uttara Ashadha',
                        nakshatra_pada: 1,
                        star_lord: 'Sun',
                        sub_lord: 'Venus',
                        retrograde: false
                    },
                    {
                        planet: 'Rahu',
                        degree: '7° 21\' 48"',
                        decimal_degrees: 7.36,
                        sign: 'Capricorn',
                        sign_number: 10,
                        longitude: 277.36,
                        house: 4,
                        nakshatra: 'Uttara Ashadha',
                        nakshatra_pada: 2,
                        star_lord: 'Sun',
                        sub_lord: 'Moon',
                        retrograde: true
                    },
                    {
                        planet: 'Ketu',
                        degree: '7° 21\' 48"',
                        decimal_degrees: 7.36,
                        sign: 'Cancer',
                        sign_number: 4,
                        longitude: 97.36,
                        house: 10,
                        nakshatra: 'Pushya',
                        nakshatra_pada: 1,
                        star_lord: 'Saturn',
                        sub_lord: 'Moon',
                        retrograde: true
                    }
                ]
            };
        }

        // Ayanamsa information
        const ayanamsaInfo = {
            'kp-newcomb': 'KP-Newcomb (23° 43\' 04") is the authentic ayanamsa for Krishnamurti Paddhati astrology, providing the most accurate KP calculations.',
            'lahiri': 'Lahiri (23° 51\' 10") is the most widely used ayanamsa in Indian astrology, officially adopted by the Indian government.',
            'raman': 'B.V. Raman (22° 27\' 39") is a traditional conservative ayanamsa used by classical astrologers.',
            'krishnamurti': 'Krishnamurti Original (23° 42\' 51") is the original ayanamsa used by K.S. Krishnamurti himself.',
            'yukteshwar': 'Sri Yukteshwar (22° 46\' 39") is used in the Yogananda lineage and Self-Realization Fellowship.',
            'djwhal-khul': 'Djwhal Khul (23° 06\' 45") is used in esoteric astrology and Alice Bailey teachings.',
            'fagan-bradley': 'Fagan-Bradley (24° 44\' 12") is the standard ayanamsa for Western sidereal astrology.',
            'galactic-center': 'Galactic Center (26° 57\' 46") aligns 0° Sagittarius with the Galactic Center for cosmic astrology.'
        };

        // Update ayanamsa info when selection changes
        document.getElementById('ayanamsa').addEventListener('change', function() {
            const selected = this.value;
            document.getElementById('ayanamsa-info').textContent = ayanamsaInfo[selected];
        });

        // Section navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Update nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-white/20');
            });
            event.target.closest('.nav-link').classList.add('bg-white/20');
        }

        // Form submission
        document.getElementById("birth-form").onsubmit = async function(e) {
            e.preventDefault();
            
            const name = document.getElementById("name").value;
            const date = document.getElementById("date").value;
            const time = document.getElementById("time").value;
            const place = document.getElementById("place").value;
            const ayanamsa = document.getElementById("ayanamsa").value;
            const gender = document.getElementById("gender").value;
            const timezone = document.getElementById("timezone").value;
            
            // Debug validation
            console.log('🔍 Validating fields:', { name, date, time, place, ayanamsa });
            
            if (!name || !date || !time || !place) {
                alert(`Please fill in all required fields:\n- Name: ${name ? '✅' : '❌'}\n- Date: ${date ? '✅' : '❌'}\n- Time: ${time ? '✅' : '❌'}\n- Place: ${place ? '✅' : '❌'}`);
                return;
            }
            
            console.log('✅ All fields validated successfully');
            
            // Show progressive loading states
            const chartResults = document.getElementById("chart-results");
            
            function updateProgress(step, message) {
                chartResults.innerHTML = `
                    <div class="glass rounded-xl p-8 text-center">
                        <div class="animate-spin text-6xl text-yellow-400 mb-4">
                            <i class="fas fa-star"></i>
                        </div>
                        <h3 class="text-2xl font-bold mb-4 text-yellow-300">Step ${step}: ${message}</h3>
                        <p class="text-gray-300 mb-2">Using ${ayanamsaInfo[ayanamsa].split(' (')[0]} Ayanamsa</p>
                        <div class="mt-4 space-y-2 text-sm text-left max-w-md mx-auto">
                            <div class="flex items-center ${step >= 1 ? 'text-green-400' : 'text-gray-500'}">
                                <i class="fas fa-check-circle mr-2"></i>Validating input data
                            </div>
                            <div class="flex items-center ${step >= 2 ? 'text-green-400' : 'text-gray-500'}">
                                <i class="fas fa-check-circle mr-2"></i>Parsing birth information
                            </div>
                            <div class="flex items-center ${step >= 3 ? 'text-green-400' : 'text-gray-500'}">
                                <i class="fas fa-check-circle mr-2"></i>Applying ayanamsa correction
                            </div>
                            <div class="flex items-center ${step >= 4 ? 'text-green-400' : 'text-gray-500'}">
                                <i class="fas fa-check-circle mr-2"></i>Calculating planetary positions
                            </div>
                            <div class="flex items-center ${step >= 5 ? 'text-green-400' : 'text-gray-500'}">
                                <i class="fas fa-check-circle mr-2"></i>Computing nakshatras & sub-lords
                            </div>
                            <div class="flex items-center ${step >= 6 ? 'text-green-400' : 'text-gray-500'}">
                                <i class="fas fa-check-circle mr-2"></i>Generating chart display
                            </div>
                        </div>
                    </div>
                `;
            }
            
            updateProgress(1, "Validating Input Data");
            
            // Switch to chart section
            showSection('chart');
            
            // Step 2: Parsing data
            setTimeout(() => updateProgress(2, "Parsing Birth Information"), 200);
            
            // Step 3: Preparing request
            setTimeout(() => updateProgress(3, "Applying Ayanamsa Correction"), 400);
            
            // Step 4: Making API call
            setTimeout(() => updateProgress(4, "Calculating Planetary Positions"), 600);
            
            try {
                const response = await fetch("/api/calculate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        name: name,
                        birthDate: date,
                        birthTime: time,
                        latitude: selectedCoordinates.lat,
                        longitude: selectedCoordinates.lng,
                        placeName: place,
                        ayanamsa: ayanamsa,
                        gender: gender,
                        timezone: timezone
                    })
                });
                
                // Step 5: Processing response
                updateProgress(5, "Computing Nakshatras & Sub-Lords");
                
                const data = await response.json();
                
                console.log('📊 API Response received:', data.success ? 'SUCCESS' : 'ERROR'); // Debug log
                console.log('🔍 Response data:', data); // Full response for debugging
                
                if (data.success) {
                    // Step 6: Final display
                    updateProgress(6, "Generating Chart Display");
                    
                    // Small delay to show final step, then display results
                    setTimeout(() => {
                        currentChart = data.chart;
                        displayProfessionalChart(data.chart);
                    }, 500);
                    
                    // Also calculate Dasha system
                    const moonPlanet = data.chart.planets.find(p => p.planet === 'Moon');
                    if (moonPlanet) {
                        calculateDashaSystem(moonPlanet.longitude, data.chart.birthDate);
                    }
                } else {
                    chartResults.innerHTML = `
                        <div class="glass rounded-xl p-8 text-center">
                            <i class="fas fa-exclamation-triangle text-red-400 text-4xl mb-4"></i>
                            <h3 class="text-xl font-bold text-red-400 mb-2">Calculation Error</h3>
                            <p class="text-gray-300">${data.error}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                console.error('❌ Full error details:', error); // Debug log
                
                chartResults.innerHTML = `
                    <div class="glass rounded-xl p-8 text-center">
                        <i class="fas fa-wifi text-red-400 text-4xl mb-4"></i>
                        <h3 class="text-xl font-bold text-red-400 mb-2">Connection Error</h3>
                        <p class="text-gray-300 mb-4">${error.message}</p>
                        <div class="text-left text-sm bg-gray-800/50 p-4 rounded-lg">
                            <strong class="text-yellow-300">Debug Info:</strong><br>
                            <span class="text-gray-400">Error Type:</span> ${error.name}<br>
                            <span class="text-gray-400">URL:</span> /api/calculate<br>
                            <span class="text-gray-400">Method:</span> POST<br>
                            <span class="text-gray-400">Time:</span> ${new Date().toLocaleTimeString()}<br>
                            <span class="text-gray-400">Check browser console for details</span>
                        </div>
                    </div>
                `;
            }
        };

        function displayProfessionalChart(chart) {
            const chartResults = document.getElementById("chart-results");
            
            let html = `
                <!-- Chart Header -->
                <div class="glass rounded-xl p-8 mb-8">
                    <div class="text-center mb-6">
                        <h2 class="text-4xl font-bold gradient-text mb-2">${chart.name}'s Birth Chart</h2>
                        <p class="text-xl text-gray-300">Krishnamurti Paddhati Analysis</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="text-center glass rounded-lg p-4">
                            <i class="fas fa-calendar text-blue-400 text-2xl mb-2"></i>
                            <div class="font-semibold">Birth Date</div>
                            <div class="text-blue-300">${chart.birthDate}</div>
                        </div>
                        <div class="text-center glass rounded-lg p-4">
                            <i class="fas fa-clock text-green-400 text-2xl mb-2"></i>
                            <div class="font-semibold">Birth Time</div>
                            <div class="text-green-300">${chart.birthTime}</div>
                        </div>
                        <div class="text-center glass rounded-lg p-4">
                            <i class="fas fa-map-pin text-red-400 text-2xl mb-2"></i>
                            <div class="font-semibold">Birth Place</div>
                            <div class="text-red-300">${chart.birthPlace}</div>
                        </div>
                        <div class="text-center glass rounded-lg p-4">
                            <i class="fas fa-compass text-yellow-400 text-2xl mb-2"></i>
                            <div class="font-semibold">Ayanamsa</div>
                            <div class="text-yellow-300">${chart.ayanamsa}</div>
                        </div>
                    </div>
                </div>

                <!-- Planetary Positions -->
                <div class="glass rounded-xl p-8 mb-8">
                    <h3 class="text-2xl font-bold mb-6 text-center text-yellow-300">
                        <i class="fas fa-globe-americas mr-3"></i>Planetary Positions
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;
            
            chart.planets.forEach(planet => {
                const planetIcons = {
                    'Sun': 'fas fa-sun text-yellow-400',
                    'Moon': 'fas fa-moon text-blue-300',
                    'Mercury': 'fas fa-bolt text-green-400',
                    'Venus': 'fas fa-heart text-pink-400',
                    'Mars': 'fas fa-fire text-red-400',
                    'Jupiter': 'fas fa-crown text-purple-400',
                    'Saturn': 'fas fa-hourglass text-gray-400',
                    'Rahu': 'fas fa-dragon text-orange-400',
                    'Ketu': 'fas fa-eye text-indigo-400'
                };
                
                html += `
                    <div class="planet-card glass rounded-lg p-6 hover:bg-white/5 transition-all">
                        <div class="flex items-center mb-3">
                            <i class="${planetIcons[planet.planet] || 'fas fa-star'} text-2xl mr-3"></i>
                            <div class="font-bold text-xl">${planet.planet}</div>
                        </div>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Position:</span>
                                <span class="text-orange-300 font-mono">${planet.degree}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Sign:</span>
                                <span class="text-blue-300 font-semibold">${planet.sign}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">House:</span>
                                <span class="text-purple-300 font-semibold">${planet.house}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Nakshatra:</span>
                                <span class="text-green-300">${planet.nakshatra}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Star Lord:</span>
                                <span class="text-purple-300">${planet.star_lord}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Sub Lord:</span>
                                <span class="text-pink-300">${planet.sub_lord}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>

                <!-- Chart Visualization -->
                <div class="glass rounded-xl p-8 mb-8">
                    <h3 class="text-2xl font-bold mb-6 text-center text-yellow-300">
                        <i class="fas fa-chart-pie mr-3"></i>Birth Chart Visualization
                    </h3>
                    <div class="text-center">
                        <div class="chart-circle mx-auto mb-6 bg-gray-900/50 flex items-center justify-center">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-yellow-400">Rasi Chart</div>
                                <div class="text-sm text-gray-300">12 Houses</div>
                            </div>
                        </div>
                        <p class="text-gray-400">Interactive chart visualization coming soon...</p>
                    </div>
                </div>

                <!-- Detailed KP Analysis -->
                <div class="glass rounded-xl p-8">
                    <h3 class="text-2xl font-bold mb-6 text-center text-yellow-300">
                        <i class="fas fa-eye mr-3"></i>Complete KP Analysis
                    </h3>
                    
                    <!-- Core Planets -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="glass rounded-lg p-6 text-center border border-yellow-400/30">
                            <i class="fas fa-sun text-yellow-400 text-3xl mb-3"></i>
                            <h4 class="text-lg font-bold mb-2 text-yellow-300">Soul (Sun)</h4>
                            <div class="text-orange-300 font-semibold text-lg">${chart.planets.find(p => p.planet === 'Sun')?.sign}</div>
                            <div class="text-sm text-gray-300 mt-1">${chart.planets.find(p => p.planet === 'Sun')?.degree}</div>
                            <div class="text-sm text-gray-400 mt-2">House ${chart.planets.find(p => p.planet === 'Sun')?.house}</div>
                            <div class="text-xs text-purple-300 mt-1">Star: ${chart.planets.find(p => p.planet === 'Sun')?.star_lord}</div>
                            <div class="text-xs text-pink-300">Sub: ${chart.planets.find(p => p.planet === 'Sun')?.sub_lord}</div>
                        </div>
                        
                        <div class="glass rounded-lg p-6 text-center border border-blue-400/30">
                            <i class="fas fa-moon text-blue-300 text-3xl mb-3"></i>
                            <h4 class="text-lg font-bold mb-2 text-blue-300">Mind (Moon)</h4>
                            <div class="text-blue-300 font-semibold text-lg">${chart.planets.find(p => p.planet === 'Moon')?.sign}</div>
                            <div class="text-sm text-gray-300 mt-1">${chart.planets.find(p => p.planet === 'Moon')?.degree}</div>
                            <div class="text-sm text-gray-400 mt-2">House ${chart.planets.find(p => p.planet === 'Moon')?.house}</div>
                            <div class="text-xs text-purple-300 mt-1">Star: ${chart.planets.find(p => p.planet === 'Moon')?.star_lord}</div>
                            <div class="text-xs text-pink-300">Sub: ${chart.planets.find(p => p.planet === 'Moon')?.sub_lord}</div>
                        </div>
                        
                        <div class="glass rounded-lg p-6 text-center border border-green-400/30">
                            <i class="fas fa-bolt text-green-400 text-3xl mb-3"></i>
                            <h4 class="text-lg font-bold mb-2 text-green-300">Communication</h4>
                            <div class="text-green-300 font-semibold text-lg">${chart.planets.find(p => p.planet === 'Mercury')?.sign}</div>
                            <div class="text-sm text-gray-300 mt-1">${chart.planets.find(p => p.planet === 'Mercury')?.degree}</div>
                            <div class="text-sm text-gray-400 mt-2">House ${chart.planets.find(p => p.planet === 'Mercury')?.house}</div>
                            <div class="text-xs text-purple-300 mt-1">Star: ${chart.planets.find(p => p.planet === 'Mercury')?.star_lord}</div>
                            <div class="text-xs text-pink-300">Sub: ${chart.planets.find(p => p.planet === 'Mercury')?.sub_lord}</div>
                        </div>
                    </div>

                    <!-- Technical Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="glass rounded-lg p-6">
                            <h4 class="text-lg font-bold mb-4 text-purple-300">
                                <i class="fas fa-cog mr-2"></i>Calculation Details
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Method:</strong> ${chart.calculation_method}</div>
                                <div><strong>Ayanamsa:</strong> ${chart.ayanamsa}</div>
                                <div><strong>Chart Type:</strong> ${chart.chartType}</div>
                                <div><strong>Generated:</strong> ${new Date(chart.generated).toLocaleString()}</div>
                            </div>
                        </div>
                        
                        <div class="glass rounded-lg p-6">
                            <h4 class="text-lg font-bold mb-4 text-cyan-300">
                                <i class="fas fa-info-circle mr-2"></i>Chart Summary
                            </h4>
                            <div class="space-y-2 text-sm">
                                <div><strong>Total Planets:</strong> ${chart.planets.length}</div>
                                <div><strong>Houses Occupied:</strong> ${[...new Set(chart.planets.map(p => p.house))].length}</div>
                                <div><strong>Signs Occupied:</strong> ${[...new Set(chart.planets.map(p => p.sign))].length}</div>
                                <div><strong>Nakshatras:</strong> ${[...new Set(chart.planets.map(p => p.nakshatra))].length}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            chartResults.innerHTML = html;
        }

        async function loadCurrentTransits() {
            const transitsResults = document.getElementById("transits-results");
            transitsResults.innerHTML = `
                <div class="text-center text-yellow-400">
                    <div class="animate-spin text-4xl mb-4"><i class="fas fa-globe"></i></div>
                    <p>Loading current planetary transits...</p>
                </div>
            `;
            
            try {
                const response = await fetch('/api/transits/current');
                const data = await response.json();
                
                if (data.success) {
                    let html = `
                        <div class="text-center mb-6">
                            <p class="text-gray-300">Calculated at: ${new Date(data.calculation_time).toLocaleString()}</p>
                            <p class="text-yellow-300">Ayanamsa: ${data.ayanamsa.formatted}</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    `;
                    
                    data.transits.forEach(transit => {
                        const retrograde = transit.retrograde ? ' <i class="fas fa-redo text-red-400 ml-1"></i>' : '';
                        const speedColor = transit.speed > 0 ? 'text-green-400' : 'text-red-400';
                        
                        html += `
                            <div class="planet-card glass rounded-lg p-4">
                                <div class="font-bold text-lg text-yellow-300 mb-2">
                                    ${transit.planet}${retrograde}
                                </div>
                                <div class="space-y-1 text-sm">
                                    <div class="text-orange-300 font-mono">${transit.formatted_position}</div>
                                    <div class="text-blue-300">${transit.sign}</div>
                                    <div class="${speedColor}">Speed: ${transit.speed.toFixed(4)}°/day</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    transitsResults.innerHTML = html;
                } else {
                    transitsResults.innerHTML = `
                        <div class="text-center text-red-400">
                            <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
                            <p>Error loading transits: ${data.error}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                transitsResults.innerHTML = `
                    <div class="text-center text-red-400">
                        <i class="fas fa-wifi text-4xl mb-4"></i>
                        <p>Connection error: ${error.message}</p>
                    </div>
                `;
            }
        }

        async function calculateDashaSystem(moonLongitude, birthDate) {
            try {
                const response = await fetch('/api/dasha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        moonLongitude: moonLongitude,
                        birthDate: birthDate
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayDashaSystem(data.dasha_system);
                }
            } catch (error) {
                console.error('Error calculating Dasha:', error);
            }
        }

        function displayDashaSystem(dashaSystem) {
            const dashaResults = document.getElementById('dasha-results');
            
            let html = `
                <div class="mb-8 text-center">
                    <div class="glass rounded-lg p-6 inline-block">
                        <h4 class="text-xl font-bold text-yellow-300 mb-2">Birth Dasha Lord</h4>
                        <div class="text-3xl font-bold text-orange-400">${dashaSystem.birth_dasha_lord}</div>
                        <div class="text-sm text-gray-400">Moon in Nakshatra ${dashaSystem.moon_nakshatra}</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            `;
            
            dashaSystem.dasha_periods.forEach((dasha, index) => {
                const statusColors = {
                    'current': 'border-green-400 bg-green-900/20',
                    'past': 'border-gray-500 bg-gray-900/20',
                    'future': 'border-blue-400 bg-blue-900/20'
                };
                
                const statusIcons = {
                    'current': 'fas fa-play text-green-400',
                    'past': 'fas fa-check text-gray-400',
                    'future': 'fas fa-clock text-blue-400'
                };
                
                html += `
                    <div class="glass rounded-lg p-6 border-2 ${statusColors[dasha.status] || statusColors['future']}">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <i class="${statusIcons[dasha.status] || statusIcons['future']} text-xl mr-3"></i>
                                <h4 class="text-xl font-bold text-yellow-300">${dasha.planet} Dasha</h4>
                            </div>
                            <div class="text-sm text-gray-400">
                                ${dasha.is_birth_dasha ? 'Birth Dasha' : `Period ${index + 1}`}
                            </div>
                        </div>
                        
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-400">Start Date:</span>
                                <span class="text-blue-300">${dasha.start_date}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">End Date:</span>
                                <span class="text-blue-300">${dasha.end_date}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Duration:</span>
                                <span class="text-green-300">${dasha.duration_years} years</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400">Status:</span>
                                <span class="text-purple-300 capitalize">${dasha.status}</span>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-gray-800/50 rounded-lg">
                            <div class="text-sm text-gray-300">
                                <strong class="text-yellow-300">Effects:</strong> ${getDashaEffects(dasha.planet)}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            dashaResults.innerHTML = html;
        }

        function getDashaEffects(planet) {
            const effects = {
                'Sun': 'Leadership, authority, government connections, health issues related to heart/eyes, father\'s influence',
                'Moon': 'Emotional changes, travel, public recognition, mother\'s influence, mental peace or disturbance',
                'Mercury': 'Education, communication, business, writing, short travels, intellectual pursuits',
                'Venus': 'Marriage, relationships, luxury, arts, beauty, vehicles, material comforts',
                'Mars': 'Energy, conflicts, property matters, surgery, accidents, brother\'s influence',
                'Jupiter': 'Wisdom, spirituality, teaching, children, guru\'s blessings, financial gains',
                'Saturn': 'Hard work, delays, obstacles, chronic health issues, servants, foreign connections',
                'Rahu': 'Sudden changes, foreign influences, unconventional paths, material desires, confusion',
                'Ketu': 'Spirituality, detachment, research, past karma results, health problems'
            };
            
            return effects[planet] || 'General planetary influence period';
        }

        function generateDemoDasha(moonLongitude, birthDate) {
            // Create demo dasha data without API call
            const demoDashaSystem = {
                birth_dasha_lord: 'Mars',
                moon_nakshatra: 23,
                total_cycle_years: 120,
                dasha_periods: [
                    {
                        planet: 'Mars',
                        start_date: '1990-11-25',
                        end_date: '1997-11-25',
                        duration_years: 7,
                        duration_days: 2555,
                        is_birth_dasha: true,
                        status: 'past'
                    },
                    {
                        planet: 'Rahu',
                        start_date: '1997-11-25',
                        end_date: '2015-11-25',
                        duration_years: 18,
                        duration_days: 6574,
                        is_birth_dasha: false,
                        status: 'past'
                    },
                    {
                        planet: 'Jupiter',
                        start_date: '2015-11-25',
                        end_date: '2031-11-25',
                        duration_years: 16,
                        duration_days: 5844,
                        is_birth_dasha: false,
                        status: 'current'
                    },
                    {
                        planet: 'Saturn',
                        start_date: '2031-11-25',
                        end_date: '2050-11-25',
                        duration_years: 19,
                        duration_days: 6939,
                        is_birth_dasha: false,
                        status: 'future'
                    },
                    {
                        planet: 'Mercury',
                        start_date: '2050-11-25',
                        end_date: '2067-11-25',
                        duration_years: 17,
                        duration_days: 6209,
                        is_birth_dasha: false,
                        status: 'future'
                    }
                ],
                calculation_date: new Date().toISOString()
            };
            
            displayDashaSystem(demoDashaSystem);
        }

        // Google Places Integration
        let selectedCoordinates = { lat: 10.3833, lng: 78.8167 }; // Default Pudukkottai
        
        function initGooglePlaces() {
            const placeInput = document.getElementById('place');
            const suggestionsDiv = document.getElementById('place-suggestions');
            const coordinatesDisplay = document.getElementById('coordinates-display');
            
            // Fallback to manual search if Google Maps not available
            if (typeof google === 'undefined') {
                console.log('🌍 Google Maps not loaded, using manual city search');
                setupManualCitySearch();
                return;
            }
            
            const autocomplete = new google.maps.places.Autocomplete(placeInput, {
                types: ['(cities)'],
                fields: ['place_id', 'geometry', 'name', 'formatted_address']
            });
            
            autocomplete.addListener('place_changed', function() {
                const place = autocomplete.getPlace();
                if (place.geometry) {
                    selectedCoordinates = {
                        lat: place.geometry.location.lat(),
                        lng: place.geometry.location.lng()
                    };
                    coordinatesDisplay.textContent = 
                        `Coordinates: ${selectedCoordinates.lat.toFixed(4)}°N, ${selectedCoordinates.lng.toFixed(4)}°E`;
                    console.log('📍 Selected place:', place.formatted_address, selectedCoordinates);
                }
            });
        }
        
        function setupManualCitySearch() {
            const placeInput = document.getElementById('place');
            const suggestionsDiv = document.getElementById('place-suggestions');
            
            // Common Indian cities with coordinates
            const cities = [
                { name: 'Pudukkottai, Tamil Nadu, India', lat: 10.3833, lng: 78.8167 },
                { name: 'Chennai, Tamil Nadu, India', lat: 13.0827, lng: 80.2707 },
                { name: 'Mumbai, Maharashtra, India', lat: 19.0760, lng: 72.8777 },
                { name: 'Delhi, India', lat: 28.7041, lng: 77.1025 },
                { name: 'Bangalore, Karnataka, India', lat: 12.9716, lng: 77.5946 },
                { name: 'Hyderabad, Telangana, India', lat: 17.3850, lng: 78.4867 },
                { name: 'Kolkata, West Bengal, India', lat: 22.5726, lng: 88.3639 },
                { name: 'Pune, Maharashtra, India', lat: 18.5204, lng: 73.8567 },
                { name: 'Ahmedabad, Gujarat, India', lat: 23.0225, lng: 72.5714 },
                { name: 'Jaipur, Rajasthan, India', lat: 26.9124, lng: 75.7873 }
            ];
            
            placeInput.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                if (query.length < 2) {
                    suggestionsDiv.classList.add('hidden');
                    return;
                }
                
                const matches = cities.filter(city => 
                    city.name.toLowerCase().includes(query)
                );
                
                if (matches.length > 0) {
                    suggestionsDiv.innerHTML = matches.map(city => 
                        `<div class="p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0" 
                              onclick="selectCity('${city.name}', ${city.lat}, ${city.lng})">
                            <div class="text-white">${city.name}</div>
                            <div class="text-xs text-gray-400">${city.lat.toFixed(4)}°N, ${city.lng.toFixed(4)}°E</div>
                         </div>`
                    ).join('');
                    suggestionsDiv.classList.remove('hidden');
                } else {
                    suggestionsDiv.classList.add('hidden');
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!placeInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.classList.add('hidden');
                }
            });
        }
        
        function selectCity(cityName, lat, lng) {
            document.getElementById('place').value = cityName;
            selectedCoordinates = { lat, lng };
            document.getElementById('coordinates-display').textContent = 
                `Coordinates: ${lat.toFixed(4)}°N, ${lng.toFixed(4)}°E`;
            document.getElementById('place-suggestions').classList.add('hidden');
            console.log('📍 Selected city:', cityName, { lat, lng });
        }

        // Initialize with default values for Pudukkottai birth data
        window.addEventListener('load', function() {
            // Pre-fill the form with the birth data you provided
            document.getElementById('name').value = 'Selvapriyan';
            document.getElementById('date').value = '1990-11-25';
            document.getElementById('time').value = '03:17:00';
            document.getElementById('place').value = 'Pudukkottai, Tamil Nadu, India';
            
            // Initialize Google Places or fallback
            setTimeout(initGooglePlaces, 1000);
            
            // Show home section by default
            showSection('home');
        });
    </script>
</body>
</html>